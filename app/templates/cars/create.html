{% extends 'base_template.html' %}

{% block content %}

<!-- Hero Section -->
<section class="hero-wrap hero-wrap-2" style="background-image: url('{{ url_for('static', filename='images/banner.jpg') }}');" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row no-gutters slider-text align-items-end justify-content-start">
            <div class="col-md-9 pb-5">
                <h1 class="mb-3 bread">Registrar Vehículo</h1>
                <a href="{{ url_for('base.base') }}">Volver a Inicio</a>
            </div>
        </div>
    </div>
</section>

<!-- Vehicle Registration Form Section -->
<section class="ftco-section">
    <div class="container d-flex justify-content-center align-items-center">
        <div class="form-container w-75 bg-light p-5 rounded">
            <h2 class="text-center mb-4">Formulario de Registro de Vehículo</h2>
            <form action="{{ url_for('cars.create_car_route') }}" method="POST" enctype="multipart/form-data" class="contact-form">

                <!-- Información Básica -->
                <h4 class="mb-3">Información Básica</h4>
                <div class="form-group">
                    <label for="brand">Marca</label>
                    <select id="brand" name="brand" class="form-control" required>
                        <option value="Toyota">Toyota</option>
                        <option value="Honda">Honda</option>
                        <option value="Ford">Ford</option>
                        <option value="Volkswagen">Volkswagen</option>
                        <option value="Hyundai">Hyundai</option>
                        <option value="Nissan">Nissan</option>
                        <option value="Kia">Kia</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="model">Modelo</label>
                    <input type="text" id="model" name="model" class="form-control" maxlength="50" required>
                </div>
                <div class="form-group">
                    <label for="fabrication_year">Año de Fabricación</label>
                    <input type="number" id="fabrication_year" name="fabrication_year" class="form-control" min="1900" max="2099" required>
                </div>
                <div class="form-group">
                    <label for="plate">Matrícula</label>
                    <input type="text" id="plate" name="plate" class="form-control" maxlength="10" required>
                </div>
                <div class="form-group">
                    <label for="color">Color</label>
                    <input type="text" id="color" name="color" class="form-control" maxlength="20" required>
                </div>
                <div class="form-group">
                    <label for="chairs">Capacidad de Pasajeros</label>
                    <select id="chairs" name="chairs" class="form-control" required>
                        <option value="2">2</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="7">7</option>
                        <option value="9">9</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="car_type">Tipo de Vehículo</label>
                    <select id="car_type" name="car_type" class="form-control" required>
                        <option value="SUV">SUV</option>
                        <option value="Sedán">Sedán</option>
                        <option value="Hatchback">Hatchback</option>
                        <option value="Pickup">Pickup</option>
                        <option value="Van">Van</option>
                    </select>
                </div>

                <!-- Características Técnicas -->
                <h4 class="mb-3 mt-4">Características Técnicas</h4>
                <div class="form-group">
                    <label for="transmission">Transmisión</label>
                    <select id="transmission" name="transmission" class="form-control" required>
                        <option value="Automático">Automático</option>
                        <option value="Manual">Manual</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="fuel">Combustible</label>
                    <select id="fuel" name="fuel" class="form-control" required>
                        <option value="Gasolina">Gasolina</option>
                        <option value="Diesel">Diesel</option>
                        <option value="GLP">GLP</option>
                        <option value="GNV">GNV</option>
                        <option value="Eléctrico">Eléctrico</option>
                        <option value="Híbrido">Híbrido</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="kilometer">Kilometraje</label>
                    <input type="number" id="kilometer" name="kilometer" class="form-control" min="0" required>
                </div>
                <div class="form-group">
                    <label for="power">Potencia (HP)</label>
                    <input type="number" id="power" name="power" class="form-control" min="0" required>
                </div>

                <!-- Estado y Equipamiento -->
                <h4 class="mb-3 mt-4">Estado y Equipamiento</h4>
                <div class="form-group">
                    <label for="status">Estado</label>
                    <select id="status" name="status" class="form-control" required>
                        <option value="Disponible">Disponible</option>
                        <option value="Mantenimiento">Mantenimiento</option>
                        <option value="Reservado">Reservado</option>
                        <option value="Inactivo">Inactivo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" name="gps"> GPS</label>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" name="ac"> A/C</label>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" name="bluetooth"> Bluetooth</label>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" name="rear_camera"> Cámara de Retroceso</label>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" name="parking_sensors"> Sensores de Estacionamiento</label>
                </div>

                <!-- Información Comercial -->
                <h4 class="mb-3 mt-4">Información Comercial</h4>
                <div class="form-group">
                    <label for="category">Categoría</label>
                    <select id="category" name="category" class="form-control" required>
                        <option value="Económico">Económico</option>
                        <option value="Intermedio">Intermedio</option>
                        <option value="Premium">Premium</option>
                        <option value="Lujo">Lujo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="daily_rate">Tarifa Diaria</label>
                    <input type="number" id="daily_rate" name="daily_rate" class="form-control" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="insurance_date">Seguro Vigente Hasta</label>
                    <input type="date" id="insurance_date" name="insurance_date" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="itv_date">ITV/Revisión</label>
                    <input type="date" id="itv_date" name="itv_date" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="photos">Fotos del Vehículo</label>
                    <input type="file" id="photos" name="photos" class="form-control" multiple>
                </div>
                <div class="form-group">
                    <label for="description">Descripción</label>
                    <textarea id="description" name="description" class="form-control" rows="4"></textarea>
                </div>

                <!-- Botón de Enviar -->
                <div class="form-group text-center">
                    <button type="submit" class="btn btn-primary py-3 px-5">Registrar Vehículo</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mensajes Flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="alert-section mt-4">
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    {% endwith %}
</section>

<!-- Validaciones en el frontend -->
<script>
    document.querySelector('form').addEventListener('submit', function (e) {
        const fabricationYear = document.getElementById('fabrication_year').value;
        const insuranceDate = document.getElementById('insurance_date').value;
        const itvDate = document.getElementById('itv_date').value;

        if (fabricationYear < 1900 || fabricationYear > 2099) {
            alert('El año debe estar entre 1900 y 2099.');
            e.preventDefault();
        }

        if (new Date(insuranceDate) < new Date()) {
            alert('La fecha del seguro debe ser futura.');
            e.preventDefault();
        }

        if (new Date(itvDate) < new Date()) {
            alert('La fecha de la ITV debe ser futura.');
            e.preventDefault();
        }
    });
</script>

{% endblock %}
